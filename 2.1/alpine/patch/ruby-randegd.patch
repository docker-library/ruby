diff --git ext/openssl/extconf.rb ext/openssl/extconf.rb
index c2fc8b0..39e091d 100644
--- ext/openssl/extconf.rb
+++ ext/openssl/extconf.rb
@@ -87,6 +87,7 @@ have_func("HMAC_CTX_init")
 have_func("PEM_def_callback")
 have_func("PKCS5_PBKDF2_HMAC")
 have_func("PKCS5_PBKDF2_HMAC_SHA1")
+have_func("RAND_egd")
 have_func("X509V3_set_nconf")
 have_func("X509V3_EXT_nconf_nid")
 have_func("X509_CRL_add0_revoked")
diff --git ext/openssl/ossl_rand.c ext/openssl/ossl_rand.c
index abd1809..63c3c20 100644
--- ext/openssl/ossl_rand.c
+++ ext/openssl/ossl_rand.c
@@ -125,6 +125,8 @@ ossl_rand_pseudo_bytes(VALUE self, VALUE len)
     return str;
 }
 
+#ifdef HAVE_RAND_EGD
+
 /*
  *  call-seq:
  *     egd(filename) -> true
@@ -158,6 +160,7 @@ ossl_rand_egd_bytes(VALUE self, VALUE filename, VALUE len)
     }
     return Qtrue;
 }
+#endif /* HAVE_RAND_EGD */
 
 /*
  *  call-seq:
@@ -195,8 +198,10 @@ Init_ossl_rand()
     DEFMETH(mRandom, "write_random_file", ossl_rand_write_file, 1);
     DEFMETH(mRandom, "random_bytes", ossl_rand_bytes, 1);
     DEFMETH(mRandom, "pseudo_bytes", ossl_rand_pseudo_bytes, 1);
+#ifdef HAVE_RAND_EGD
     DEFMETH(mRandom, "egd", ossl_rand_egd, 1);
     DEFMETH(mRandom, "egd_bytes", ossl_rand_egd_bytes, 2);
+#endif /* HAVE_RAND_EGD */
     DEFMETH(mRandom, "status?", ossl_rand_status, 0)
 }
 
